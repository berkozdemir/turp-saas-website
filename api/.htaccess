# Enable Authorization header passthrough
# Required for PHP CGI/FastCGI environments

# Pass Authorization header to PHP
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Pass Authorization header
    RewriteCond %{HTTP:Authorization} .+
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

# Alternative method for mod_setenvif
<IfModule mod_setenvif.c>
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
</IfModule>

# PHP CGI specific fix
<IfModule mod_cgi.c>
    RewriteCond %{HTTP:Authorization} ^(.*)
    RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]
</IfModule>

# ========================================
# SECURITY: Block access to sensitive files
# ========================================

# Block access to env.php (credentials file)
<Files "env.php">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

# Block access to all helper files (only index.php should be accessed)
<FilesMatch "^(auth_helper|email_helper|forgot_password_helper|db_connection)\.php$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Block access to SQL files
<FilesMatch "\.(sql|log|bak|backup|old)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Block access to version.txt and other sensitive text files
<Files "version.txt">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>
